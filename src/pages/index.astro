---
import { type CollectionEntry, getCollection } from "astro:content";
import SocialList from "@/components/SocialList.astro";
import PostPreview from "@/components/blog/PostPreview.astro";
import ProjectPreview from "@/components/project/ProjectPreview.astro";
import { getAllPosts } from "@/data/post";
import PageLayout from "@/layouts/Base.astro";
import { collectionDateSort } from "@/utils/date";

// Posts
const MAX_POSTS = 10;
const allPosts = await getAllPosts();
const allPostsByDate = allPosts
	.sort(collectionDateSort)
	.slice(0, MAX_POSTS) as CollectionEntry<"post">[];

// Projects
const allProjects = await getCollection("project");
const sortedProjects = allProjects.sort((a, b) => a.data.order - b.data.order);
---

<PageLayout meta={{ title: "Home" }}>
	<section>
		<h1 class="title mb-6">Hello World!</h1>
		<p class="mb-4">
			Hi, I'm a theme for Astro, a simple starter that you can use to create your website or blog.
			If you want to know more about how you can customise me, add more posts, and make it your own,
			click on the GitHub icon link below and it will take you to my repo.
		</p>
		<SocialList />
	</section>

	<section class="mt-16">
		<h2 class="title text-accent mb-6 text-xl">Projects</h2>
		<div class="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
			{
				sortedProjects.map((project) => (
					<ProjectPreview project={project} />
				))
			}
		</div>
	</section>

	<section class="mt-16">
		<h2 class="title text-accent mb-6 text-xl"><a href="/posts/">Blog Posts</a></h2>
		<ul class="space-y-6" role="list">
			{
				allPostsByDate.map((p) => (
					<li class="grid gap-2 sm:grid-cols-[auto_1fr]">
						<PostPreview post={p} />
					</li>
				))
			}
		</ul>
	</section>
</PageLayout>
